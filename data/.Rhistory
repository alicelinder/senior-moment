rm(list = ls())
setwd("~/GitHub/senior-moment/data")
setwd("~/Library/Mobile Documents/com~apple~CloudDocs/GitHub/senior-moment/data")
library(geometry)
library(FD)
library(dplyr)
library(reshape2)
library(plyr)
tree.traits <- read.csv("tree-traits.csv")
tree.traits["leaf.mass"] <- tree.traits$Fresh.mass - tree.traits$Dry.mass
tree.traits <- tree.traits[,-13:-17]
tree.traits <- tree.traits[,-14:-21]
# clean up data and subset it based on species
traits <- select(tree.traits, Site, Species, Leaf.area, Stem.volume,
Height, DBH, X.N, X.C, Stomatal.Length, Stomatal.Density,
leaf.mass)
class(traits)
## DO I NEED TO DO THIS?
#traits <- na.omit(traits)
# create data frame to store convex hull values with 176 rows x 9 columns
con.hull <- data.frame(matrix(NA, nrow = 176, ncol = 10))
rownames(con.hull) <- NULL
colnames(con.hull) <- c("Species", "Site", "Leaf.area", "Stem.volume", "Height",
"DBH", "X.N", "X.C", "Stomatal.Length",
"Stomatal.Density", "leaf.mass")
?convhulln
# find max and min values of each trait within each species
range.function <- function(x) {
com.names <- unique(as.data.frame(traits$Species))
apply(traits[com.names, ], MARGIN = 2, max) -
apply(traits[com.names, ], MARGIN = 2, min)
}
# create matrix containing traits of the species with rows = species and columns = traits for one species, at one site
head(traits)
traits$SLA = traits$Leaf.area / traits$leaf.mass
ex <- subset(traits, Site == "GR" & Species == "ACEPEN")
# choose traits
tr <- c("SLA", "Stem.volume", "DBH", "X.N")
# Find complete cases for this set
ex <- ex[complete.cases(ex[tr]),]
vol = convhulln(ex[tr], "FA")$vol
# now apply this across all species and sites
chvols = vector()
for(site in unique(traits$Site)){
for(sp in unique(traits$Species)){
ex <- subset(traits, Site == site & Species == sp)
# Find complete cases for this set
ex <- ex[complete.cases(ex[tr]),]
if(nrow(ex) < length(tr)) vol = NA
else  vol = convhulln(ex[tr], "FA")$vol
chvols = rbind(chvols, data.frame(site, sp, vol, n = nrow(ex)))
}
}
con.hull <- data.frame(matrix(NA, nrow = 176, ncol = 10))
rownames(con.hull) <- NULL
colnames(con.hull) <- c("Species", "Site", "Leaf.area", "Stem.volume", "Height",
"DBH", "X.N", "X.C", "Stomatal.Length",
"Stomatal.Density", "leaf.mass")
tree.traits <- read.csv("tree-traits.csv")
class(tree.traits$Fresh.mass)
tree.traits["leaf.mass"] <- tree.traits$Fresh.mass - tree.traits$Dry.mass
tree.traits <- tree.traits[,-13:-17]
tree.traits <- tree.traits[,-14:-21]
traits <- select(tree.traits, Site, Species, Leaf.area, Stem.volume,
Height, DBH, X.N, X.C, Stomatal.Length, Stomatal.Density,
leaf.mass)
class(traits)
con.hull <- data.frame(matrix(NA, nrow = 176, ncol = 10))
rownames(con.hull) <- NULL
colnames(con.hull) <- c("Species", "Site", "Leaf.area", "Stem.volume", "Height",
"DBH", "X.N", "X.C", "Stomatal.Length",
"Stomatal.Density", "leaf.mass")
?convhulln
range.function <- function(x) {
com.names <- unique(as.data.frame(traits$Species))
apply(traits[com.names, ], MARGIN = 2, max) -
apply(traits[com.names, ], MARGIN = 2, min)
}
head(traits)
traits$SLA = traits$Leaf.area / traits$leaf.mass
ex <- subset(traits, Site == "GR" & Species == "ACEPEN")
tr <- c("SLA", "Stem.volume", "DBH", "X.N")
ex <- ex[complete.cases(ex[tr]),]
vol = convhulln(ex[tr], "FA")$vol
chvols = vector()
for(site in unique(traits$Site)){
for(sp in unique(traits$Species)){
ex <- subset(traits, Site == site & Species == sp)
# Find complete cases for this set
ex <- ex[complete.cases(ex[tr]),]
if(nrow(ex) < length(tr)) vol = NA
else  vol = convhulln(ex[tr], "FA")$vol
chvols = rbind(chvols, data.frame(site, sp, vol, n = nrow(ex)))
}
}
View(con.hull)
View(chvols)
View(tree.traits)
rm(list = ls())
setwd("~/Library/Mobile Documents/com~apple~CloudDocs/GitHub/senior-moment/data")
setwd("~/Library/Mobile Documents/com~apple~CloudDocs/GitHub/senior-moment/data")
library(geometry)
library(FD)
library(dplyr)
library(reshape2)
library(plyr)
tree.traits <- read.csv("tree-traits.csv")
class(tree.traits$Fresh.mass)
tree.traits["leaf.mass"] <- tree.traits$Fresh.mass - tree.traits$Dry.mass
tree.traits <- tree.traits[,-13:-17]
tree.traits <- tree.traits[,-14:-21]
traits <- select(tree.traits, Site, Species, Leaf.area, Stem.volume,
Height, DBH, X.N, X.C, Stomatal.Length, Stomatal.Density,
leaf.mass)
class(traits)
View(tree.traits)
tree.traits <- read.csv("tree-traits.csv")
class(tree.traits$Fresh.mass)
View(tree.traits)
tree.traits <- tree.traits[,-13:-17]
Stem.density <- tree.traits$Stem.mass/tree.traits$Stem.volume
tree.traits <- data.frame(tree.traits, Stem.density)
View(tree.traits)
traits <- complete.cases(tree.traits)
View(tree.traits)
?complete.cases
stopifnot(complete.cases(y) != is.na(y))
x <- airquality[, -1] # x is a regression design matrix
y <- airquality[,  1] # y is the corresponding response
View(x)
stopifnot(complete.cases(y) != is.na(y))
ok <- complete.cases(x, y)
sum(!ok) # how many are not "ok" ?
x <- x[ok,]
y <- y[ok]
stopifnot(complete.cases(tree.traits) != is.na(tree.traits))
ok <- complete.cases(tree.traits)
sum(!ok) # how many are not "ok" ?
traits <- select(tree.traits, Site, Species, Leaf.area, Stem.density,
Height, DBH, X.N, X.C, Stomatal.Length, Stomatal.Density,
leaf.mass)
traits <- complete.cases(tree.traits)
traits <- select(tree.traits, Site, Species, Leaf.area, Stem.density,
Height, DBH, X.N, X.C, Stomatal.Length, Stomatal.Density,
leaf.mass)
traits <- select(tree.traits, Site, Species, Leaf.area, Stem.density,
Height, DBH, X.N, X.C, Stomatal.Length, Stomatal.Density)
stopifnot(complete.cases(traits) != is.na(traits))
ok <- complete.cases(traits)
sum(!ok) # how many are not "ok" ?
traits <- traits[ok,]
View(traits)
head(traits)
traits$SLA = traits$Leaf.area / traits$leaf.mass
View(traits)
tree.traits$SLA = tree.traits$Leaf.area / tree.traits$leaf.mass
tree.traits <- read.csv("tree-traits.csv")
class(tree.traits$Fresh.mass)
tree.traits <- tree.traits[,-13:-17]
tree.traits <- tree.traits[,-14:-21]
Stem.density <- tree.traits$Stem.mass/tree.traits$Stem.volume
tree.traits <- data.frame(tree.traits, Stem.density)
tree.traits$SLA = tree.traits$Leaf.area / tree.traits$leaf.mass
traits$SLA = traits$Leaf.area / traits$leaf.mass
tr <- c("SLA", "Stem.volume", "DBH", "X.N")
View(tree.traits)
SLA <- tree.traits$Leaf.area / tree.traits$Dry.mass
tree.traits <- data.frame(tree.traits, SLA)
traits <- select(tree.traits, Site, Species, Leaf.area, Stem.density,
Height, DBH, X.N, X.C, Stomatal.Length, Stomatal.Density)
traits <- select(tree.traits, Site, Species, SLA, Stem.density,
Height, DBH, X.N, X.C, Stomatal.Length, Stomatal.Density)
stopifnot(complete.cases(traits) != is.na(traits))
ok <- complete.cases(traits)
sum(!ok) # how many are not "ok" ?
traits <- traits[ok,]
head(traits)
traits$SLA = traits$Leaf.area / traits$leaf.mass
ex <- subset(traits, Site == "GR" & Species == "ACEPEN")
tr <- c("SLA", "Stem.volume", "DBH", "X.N")
ex <- ex[complete.cases(ex[tr]),]
vol = convhulln(ex[tr], "FA")$vol
ex <- subset(traits, Site == "GR" & Species == "ACEPEN")
View(ex)
tr <- c("SLA", "Stem.volume", "DBH", "X.N")
ex <- ex[complete.cases(ex[tr]),]
vol = convhulln(ex[tr], "FA")$vol
vol = convhulln(ex, "FA")$vol
View(ex)
